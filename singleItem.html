<!DOCTYPE HTML>
<html lang="en">

<head>
    <!--=============== basic  ===============-->
    <meta charset="UTF-8">
    <title id="topTitle"></title>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="index, follow" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <!--=============== css  ===============-->
    <link type="text/css" rel="stylesheet" href="css/reset.css">
    <link type="text/css" rel="stylesheet" href="css/plugins.css">
    <link type="text/css" rel="stylesheet" href="css/style.css">
    <link type="text/css" rel="stylesheet" href="css/style-dark.css">
    <!--=============== favicons ===============-->
    <link rel="shortcut icon" href="images/favicon.ico">
</head>

<body>
    <!--loader-->
    <div class="loader-wrap">
        <div class="spinner">
            <div class="double-bounce1"></div>
            <div class="double-bounce2"></div>
        </div>
    </div>
    <!--loader end-->
    <!-- main start  -->
    <div id="main">
        <!-- header start  -->
        <header class="main-header">
            <a href="index.html" class="logo-holder"><img src="images/logo.png" alt=""></a>  
            <!-- logo end  -->		
            <!-- search -->				
            <div class="search-button"><i class="far fa-search"></i></div>
            <div class="search-input"><input name="se" id="se" type="text" class="search" placeholder="Search.." /></div>
            <!-- search end  -->
            <!-- mobile nav -->
            <div class="nav-button-wrap">
                <div class="nav-button"><span></span><span></span><span></span></div>
            </div>
            <!-- mobile nav end-->				
            <!--  navigation -->
            <div class="nav-holder main-menu">
                <nav>
                    <ul>
                        <li>
                            <a href="index.html">Home </a>
                        </li>
                        <li>
                            <a href="store.html">Store </a>
                        </li>
                        <li>
                            <a href="about.html">About</a>
                        </li>
                        <li>
                            <a href="cart.html" id="navCart">
                                <i class="fa fa-shopping-cart"></i> Cart
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </header>
        <!-- header end -->
        <!-- wrapper  -->
        <div id="wrapper">
            <!-- content -->
            <div class="content">
                <!-- column-image  -->
                <div id="columnImage"></div>
                <!-- column-image end  -->
                <!-- column-wrapper -->
                <div class="column-wrapper single-content-section">
                    <section id="infoBox"></section>
                    <footer class="min-footer fl-wrap content-animvisible">
                        <div class="container small-container">
                            <div class="footer-inner fl-wrap">
                                <!-- policy-box-->
                                <div class="policy-box">
                                    <span>&#169; klothz 2020 / All rights reserved. </span>
                                </div>
                                <!-- policy-box end-->
                            </div>
                        </div>
                    </footer>
                </div>
                <!-- column-wrapper -->
            </div>
            <!--content end-->
        </div>
        <!-- wrapper end -->
    </div>
    <!-- Main end -->
    <!--=============== scripts  ===============-->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/plugins.js"></script>
    <script type="text/javascript" src="js/scripts.js"></script>
    <script src="js/mgGlitch.min.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/utils.js"></script>

    <script type="text/javascript">
        /*<![CDATA[*/
        function shopifyMain() {
            var scriptURL = 'https://sdks.shopifycdn.com/buy-button/latest/buy-button-storefront.min.js';
            if (window.ShopifyBuy) {
                if (window.ShopifyBuy.UI) {
                ShopifyBuyInit();
                } else {
                loadScript();
                }
            } else {
                loadScript();
            }
            function loadScript() {
                var script = document.createElement('script');
                script.async = true;
                script.src = scriptURL;
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(script);
                script.onload = ShopifyBuyInit;
            }
            function ShopifyBuyInit() {
                var client = ShopifyBuy.buildClient({
                domain: 'klothz-testing.myshopify.com',
                storefrontAccessToken: 'ff00c2ad865128165184b6bb58de432e',
                });
                ShopifyBuy.UI.onReady(client).then(function (ui) {
                ui.createComponent('product', {
                    id: '4624853762187',
                    node: document.getElementById('product-component-1583530868354'),
                    moneyFormat: '%24%7B%7Bamount%7D%7D',
                    options: {
            "product": {
                "styles": {
                "button": {
                    ":hover": {
                    "background-color": "#464646"
                    },
                    "background-color": "#292929",
                    ":focus": {
                    "background-color": "#464646"
                    },
                    "border-radius": "0px",
                    "margin-top": "0px"
                }
                },
                "contents": {
                "img": false,
                "title": false,
                "price": false
                },
                "text": {
                "button": "Add to cart"
                }
            },
            "productSet": {
                "styles": {
                "products": {
                    "@media (min-width: 601px)": {
                    "margin-left": "-20px"
                    }
                }
                }
            },
            "modalProduct": {
                "contents": {
                "img": false,
                "imgWithCarousel": true,
                "button": false,
                "buttonWithQuantity": true
                },
                "styles": {
                "product": {
                    "@media (min-width: 601px)": {
                    "max-width": "100%",
                    "margin-left": "0px",
                    "margin-bottom": "0px"
                    }
                },
                "button": {
                    ":hover": {
                    "background-color": "#000000"
                    },
                    "background-color": "#000000",
                    ":focus": {
                    "background-color": "#000000"
                    },
                    "border-radius": "0px"
                }
                },
                "text": {
                "button": "Add to cart"
                }
            },
            "cart": {
                "styles": {
                "button": {
                    ":hover": {
                    "background-color": "#000000"
                    },
                    "background-color": "#000000",
                    ":focus": {
                    "background-color": "#000000"
                    },
                    "border-radius": "0px"
                }
                },
                "text": {
                "total": "Subtotal",
                "button": "Checkout"
                }
            },
            "toggle": {
                "styles": {
                "toggle": {
                    "background-color": "#000000",
                    ":hover": {
                    "background-color": "#000000"
                    },
                    ":focus": {
                    "background-color": "#000000"
                    }
                }
                }
            }
            },
                });
                });
            }
        }
        /*]]>*/
    </script>


    <script>
        var price;
        var firstSize = ""
        var outOfStockSizes = [];
        var element = document.getElementById("items");
        var url = document.URL
        var id = url.split("=")[1]
        // TODO Figure out how to have a constant file that will be shared between this and cart.js
        var breakCharacter = "\xA9"
        $.ajax({
            url: "https://0isykk2a2g.execute-api.us-east-1.amazonaws.com/Prod/getitem/" + id,
            method: 'GET',
            success: function (json) {
                $("#topTitle").html(json.itemName)
                price = json.price;
                appendImageHTML(json);
                generateSizes(json)
                appendInfoBox(json);
                shopifyMain();
            }
        });

        var sizeChosen = ""
        function pickSize(size){
            $(".sizeButtons").css('color', '#999')
            sizeChosen = size.innerHTML;
            let id = event.srcElement.id
            // Used when first loading a page to enable one button.
            if (id == null){
                id = size;
            }
            $("#" + id).css('color', 'white');

            for(let i = 0; i < outOfStockSizes.length; i++){
                $("#" + outOfStockSizes[i]).css('color', 'rgb(161, 24, 24)')
            }
        }

        var sizesHTML = ""
        function generateSizes(item){
            // Create HTML Elements for the buttons based on the stock list
            var stock = item.stock
            for(let i = 0; i < stock.length; i++){
                let key = Object.keys(stock[i])[0] 
                let sizeStock = Object.values(stock[i])[0] 

                if(i == 0){
                    firstSize = key;
                }

                if(sizeStock == 0){
                    outOfStockSizes.push(key);
                    sizesHTML += " " + '<a class="sizeButtons" id ="'+ key + '">' + key + '</a>'
                }   
                else{
                    sizesHTML += " " + '<a class="sizeButtons" id ="'+ key + '"onclick="pickSize(' + key + ')">' + key + '</a>'
                }  
            }   
        }

        function appendImageHTML(item) {
            $("#columnImage").append(
                $.parseHTML(
                    '<div class="column-image">' +
                        '<div class="bg-anim"><span></span></div>' +
                        '<div class="bg" data-bg="' + item.s3Image + '"></div>' +
                        '<div class="fixed-column-dec"></div>' +
                    '</div>'
                ));
        var a = $(".bg");
        a.each(function(a) {
         if ($(this).attr("data-bg")) $(this).css("background-image", "url(" + $(this).data("bg") + ")");
        });
        };

        function addToCart(){
            var itemID = id + breakCharacter + sizeChosen;
            addItem(itemID, price);
            sumCartValues();
        }

        function appendInfoBox(item){
            soldOutHTML = '<div id="product-component-1583530868354"></div>'
            totalStock = 0;
            for(let i = 0; i < item["stock"].length; i++){
                let sizeObject = item["stock"][i]
                totalStock += Object.values(sizeObject)[0]
            }
            
            // if (totalStock < 1){
            //     soldOutHTML = '<a href = "mailingList.html" class="btn soldOut-btn">OUT OF STOCK</a>';
            // }

            $("#infoBox").append(
                $.parseHTML(
                    '<section>' +
                        '<div class="container small-container">' +
                            '<div class="post fl-wrap fw-post single-post ">' +
                                '<div class="section-title fl-wrap content-animvisible">' +
                                    '<h3>' + item.itemName +'</h3>' +
                                '</div>' +
                                '<div class="pr-det-container  ">' +
                                    '<div class="caption-wrap fl-wrap  ">' +
                                        '<ul>' +
                                            '<li>' +
                                                '<span>PRICE</span>' +
                                                '<p>$'+ item.price + '</p>' +
                                            '</li>' +
                                            '<li>' +
                                                '<span>Category</span>' +
                                                '<p>' + item.type.toUpperCase() + '</p>' +
                                            '</li>' +
                                            '<li>' +
                                                '<span>Sizes</span>' +
                                                sizesHTML +
                                            '</li>' +
                                            '<li>' +
                                                '<span>PATCH_TYPE</span>' +
                                                '<p>' +  item.patchType.toUpperCase() + '</p>' +
                                            '</li>' +
                                        '</ul>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                        soldOutHTML +
                    '</section>' 
                ));
            pickSize(firstSize)
        }
    </script>
</body>

</html>